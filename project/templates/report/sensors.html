{% extends 'template.html' %}
{% load static %}


{% block navigation %}
    <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'home_index' %}">
                <img src="{% static 'img/user_icon.svg' %}" alt="Avatar Logo" style="width:40px;" class="rounded-pill"> 
                <span class="navbar-text">{{ wialon_user }}</span>
            </a>

            <div class="collapse navbar-collapse" id="mynavbar">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                <a class="nav-link" href="{% url 'home_index' %}">Link</a></a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="{% url 'home_index' %}">Link</a></a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="{% url 'home_index' %}">Link</a></a>
                </li>
                
            </ul>
            <form class="d-flex">
                <input class="form-control me-2" type="text" placeholder="Поиск">
                <button class="btn btn-primary" type="button">Поиск</button>
            </form>
            </div>
        </div>
{% endblock navigation %}


{% block content %}
    <div>
        {{ sensors }}
    </div>

    <div>
        {{ statistics }}
    </div>
    
{% endblock %}


{% block js_scripts %}
<script>
    async function query_wialon_get_last_events() {
        try {
            let response = await fetch('/api/wialon/get_last_events/');
            let data = await response.json();
            
            if ('error' in data) {
                console.log("Error in data received from API:", data);
                let logoutResponse = await fetch('/logout/');
                if (logoutResponse.ok) {
                    console.log("Logged out successfully, reloading page.");
                    window.location.reload();
                } else {
                    console.error("Failed to log out");
                }
            } else {
                console.log("Data received from API:", data);
            }
        } catch (error) {
            console.error("Error during fetch operation:", error);
        } finally {
            setTimeout(query_wialon_get_last_events, 120000);
        }
    }

    window.addEventListener('load', (event) => {
        query_wialon_get_last_events();
    });
</script>
{% endblock js_scripts %}
